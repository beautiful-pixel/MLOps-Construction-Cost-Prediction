FROM apache/airflow:2.9.3-python3.10

USER root
RUN apt-get update && apt-get install -y build-essential

WORKDIR /opt/project

COPY --chown=airflow:airflow pyproject.toml .
COPY --chown=airflow:airflow README.md .
COPY --chown=airflow:airflow src/ src/
COPY --chown=airflow:airflow deployments/airflow/requirements.txt .

USER airflow

RUN pip install --no-cache-dir -r requirements.txt
RUN pip install --no-cache-dir -e .