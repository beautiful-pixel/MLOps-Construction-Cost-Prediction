FROM apache/airflow:2.9.3-python3.10

USER root
RUN apt-get update && apt-get install -y build-essential git && rm -rf /var/lib/apt/lists/*

WORKDIR /opt/project

COPY pyproject.toml README.md ./
COPY src/ src/
COPY dags/ dags/
COPY configs/ configs/
RUN chown -R 50000:0 /opt/project

USER airflow

RUN pip install --no-cache-dir ".[airflow]"
