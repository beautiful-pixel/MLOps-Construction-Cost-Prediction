FROM apache/airflow:2.9.3-python3.10

USER root
RUN apt-get update && apt-get install -y build-essential \
    && rm -rf /var/lib/apt/lists/*

USER airflow

WORKDIR /opt/project

COPY --chown=airflow:airflow pyproject.toml README.md ./
COPY --chown=airflow:airflow src/ src/

RUN pip install --no-cache-dir -e ".[airflow]"