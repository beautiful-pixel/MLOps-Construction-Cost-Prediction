groups:
  - name: mlops-project-alerts
    interval: 30s
    rules:
      - alert: GatewayApiDown
        expr: up{job="gateway-api"} == 0
        for: 1m
        labels:
          severity: critical
        annotations:
          summary: "Gateway API injoignable."
          description: "Le job 'gateway-api' est DOWN depuis plus de 1 minute."

      - alert: InferenceApiDown
        expr: up{job="inference-api"} == 0
        for: 1m
        labels:
          severity: critical
        annotations:
          summary: "Inference API injoignable."
          description: "Le job 'inference-api' est DOWN depuis plus de 1 minute."

      - alert: NginxExporterDown
        expr: up{job="nginx-exporter"} == 0
        for: 2m
        labels:
          severity: high
        annotations:
          summary: "Nginx exporter injoignable."
          description: "Le job 'nginx-exporter' est DOWN."

      - alert: HighPredictionLatency
        expr: histogram_quantile(0.95, rate(api_request_duration_seconds_bucket{job="inference-api"}[5m])) > 5
        for: 2m
        labels:
          severity: warning
        annotations:
          summary: "Latence de prediction elevee."
          description: "Le p95 de latence des predictions depasse 5 secondes."

      - alert: AbnormalRequestRate
        expr: rate(api_requests_total{job="inference-api"}[5m]) > 1000
        for: 2m
        labels:
          severity: warning
        annotations:
          summary: "Nombre de requetes anormalement eleve."
          description: "Plus de 1000 req/s sur l'inference API."

  - alert: PrometheusScrapeFailed
    expr: up{job="prometheus"} == 0
    for: 1m
    labels:
      severity: critical
    annotations:
      summary: "Prometheus injoignable."
      description: "Prometheus est DOWN depuis plus de 1 minute."

  - alert: HighCpuUsage
    expr: (1 - avg by (instance) (rate(node_cpu_seconds_total{job="node-exporter", mode="idle"}[5m]))) > 0.9
    for: 5m
    labels:
      severity: warning
    annotations:
      summary: "CPU Ã©levÃ© sur {{ $labels.instance }}"
      description: "CPU > 90% pendant 5 minutes."

  - alert: HighMemoryUsage
    expr: (1 - (node_memory_MemAvailable_bytes{job="node-exporter"} / node_memory_MemTotal_bytes{job="node-exporter"})) > 0.8
    for: 5m
    labels:
      severity: warning
    annotations:
      summary: "RAM Ã©levÃ©e sur {{ $labels.instance }}"
      description: "RAM > 80% pendant 5 minutes."
